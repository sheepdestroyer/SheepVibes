{"id": 25, "timestamp": "2025-10-06T22:04:35.030044", "source": "agent", "message": "Command `git diff main -- backend/app.py` executed with exit code 0.", "cause": 24, "observation": "run", "tool_call_metadata": {"function_name": "execute_bash", "tool_call_id": "toolu_09", "model_response": {"id": "gen-1759788267-aAdKqvO8tZEQCzNXZveJ", "created": 1759788267, "model": "deepseek/deepseek-v3.2-exp", "object": "chat.completion", "system_fingerprint": null, "choices": [{"finish_reason": "stop", "index": 0, "message": {"content": "Now let me check the specific changes in the key files to understand what this PR is about:", "role": "assistant", "tool_calls": [{"index": 1, "function": {"arguments": "{\"command\": \"git diff main -- backend/app.py\", \"security_risk\": \"LOW\"}", "name": "execute_bash"}, "id": "toolu_09", "type": "function"}], "function_call": null}, "provider_specific_fields": {"native_finish_reason": "stop"}}], "usage": {"completion_tokens": 56, "prompt_tokens": 18914, "total_tokens": 18970, "completion_tokens_details": null, "prompt_tokens_details": null}, "provider": "DeepInfra"}, "total_calls_in_response": 1}, "content": "diff --git a/backend/app.py b/backend/app.py\nindex 80c5116..36bddae 100644\n--- a/backend/app.py\n+++ b/backend/app.py\n@@ -11,6 +11,7 @@ from apscheduler.schedulers.background import BackgroundScheduler\n import datetime\n from sqlalchemy import func, select # Added for optimized query\n from flask_caching import Cache # Added for caching\n+from flask_cors import CORS # Added for CORS support\n\n # Import db object and models from the new models.py\n from .models import db, Tab, Feed, FeedItem\n@@ -74,6 +75,9 @@ announcer = MessageAnnouncer()\n\n # Initialize Flask application\n app = Flask(__name__)\n+# Configure CORS with specific allowed origins\n+allowed_origins = [\"http://localhost:8080\", \"http://127.0.0.1:8080\"]\n+CORS(app, origins=allowed_origins, resources={r\"/api/*\": {}})\n\n # Test specific configuration\n # Check app.config first in case it's set by test runner, then env var\n@@ -833,6 +837,68 @@ def delete_feed(feed_id):\n         logger.error(f\"Error deleting feed {feed_id}: {str(e)}\", exc_info=True)\n         raise e # Let 500 handler manage response\n\n+@app.route('/api/feeds/<int:feed_id>', methods=['PUT'])\n+def update_feed_url(feed_id):\n+    \"\"\"Updates a feed's URL and name.\"\"\"\n+    # Find feed or return 404\n+    feed = db.get_or_404(Feed, feed_id)\n+\n+    data = request.get_json()\n+    # Validate input\n+    if not data or 'url' not in data or not data['url'].strip():\n+        return jsonify({'error': 'Missing feed URL'}), 400\n+\n+    new_url = data['url'].strip()\n+\n+    # Check if the new URL is already used by another feed\n+    existing_feed = Feed.query.filter(Feed.id != feed_id, Feed.url == new_url).first()\n+    if existing_feed:\n+        return jsonify({'error': f'Feed with URL {new_url} already exists'}), 409 # Conflict\n+\n+    try:\n+        # Attempt to fetch the feed to get its title\n+        parsed_feed = fetch_feed(new_url)\n+        if not parsed_feed or not parsed_feed.feed:\n+            # If fetch fails, use the URL as the name\n+            new_name = new_url\n+            new_site_link = None\n+            logger.warning(f\"Could not fetch title for {new_url}, using URL as name.\")\n+        else:\n+            new_name = parsed_feed.feed.get('title', new_url) # Use URL as fallback if title missing\n+            new_site_link = parsed_feed.feed.get('link') # Get the website link\n+\n+        # Update the feed\n+        original_url = feed.url\n+        feed.url = new_url\n+        feed.name = new_name\n+        feed.site_link = new_site_link\n+        feed.last_updated_time = datetime.datetime.now(datetime.timezone.utc)\n+\n+        db.session.commit()\n+\n+        # Trigger update to fetch new items\n+        try:\n+            success, new_items = fetch_and_update_feed(feed.id)\n+            if success and new_items > 0:\n+                invalidate_tab_feeds_cache(feed.tab_id)\n+                logger.info(f\"Cache invalidated for tab {feed.tab_id} after updating feed {feed.id}.\")\n+        except Exception as update_e:\n+            # Log error during update but don't fail the operation\n+            logger.error(f\"Error updating feed {feed.id} after URL change: {update_e}\", exc_info=True)\n+\n+        logger.info(f\"Updated feed {feed_id} from '{original_url}' to '{new_url}'.\")\n+\n+        # Return full feed data including items for frontend to update widget\n+        feed_data = feed.to_dict()\n+        # Include only recent feed items in the response (limit to 10)\n+        feed_data['items'] = [item.to_dict() for item in feed.items.order_by(FeedItem.published_time.desc()).limit(10)]\n+        return jsonify(feed_data), 200 # OK\n+\n+    except Exception as e:\n+        db.session.rollback()\n+        logger.error(f\"Error updating feed {feed_id}: {str(e)}\", exc_info=True)\n+        return jsonify({'error': 'Failed to update feed URL'}), 500\n+\n # --- Feed Items API Endpoints ---\n\n @app.route('/api/items/<int:item_id>/read', methods=['POST'])\n@@ -911,6 +977,6 @@ if __name__ == '__main__':\n     # The scheduler is already started in the global scope.\n     is_debug_mode = os.environ.get('FLASK_DEBUG', '0') == '1'\n     logger.info(f\"Starting Flask app (Debug mode: {is_debug_mode})\")\n-    app.run(host='0.0.0.0', port=5000, debug=is_debug_mode)\n+    app.run(host='0.0.0.0', port=5001, debug=is_debug_mode)\n\n     logger.info(\"SheepVibes application finished.\")", "extras": {"command": "git diff main -- backend/app.py", "metadata": {"exit_code": 0, "pid": -1, "username": "root", "hostname": "11aafdb2a889", "working_dir": "/workspace/SheepVibes", "py_interpreter_path": "/openhands/micromamba/envs/openhands/bin/python", "prefix": "", "suffix": "\n[The command completed with exit code 0.]"}, "hidden": false}, "success": true}